# OMTSF Specification: Graph Data Model

**Spec:** OMTSF-SPEC-001
**Status:** Draft
**Date:** 2026-02-18
**Revision:** 1
**License:** [CC-BY-4.0](LICENSE)
---

## Related Specifications

| Spec | Relationship |
|------|-------------|
| OMTSF-SPEC-002 (Entity Identification) | Defines external identifier structures carried by nodes and edges defined here |
| OMTSF-SPEC-003 (Merge Semantics) | Defines how graphs conforming to this model are combined |
| OMTSF-SPEC-004 (Selective Disclosure) | Defines privacy controls for the `boundary_ref` node type and `person` node constraints |

---

## 1. Overview

This specification defines the OMTSF supply chain graph data model: the file structure, node types, edge types, and structural validation rules that constitute a valid `.omts` file. It is the foundational specification upon which all other OMTSF specs depend.

An `.omts` file represents a directed labeled property multigraph where nodes represent supply chain entities (organizations, facilities, goods, persons, attestations) and edges represent relationships between them (supply, ownership, control, attestation).

---

## 2. File Structure

An `.omts` file is a JSON document with the following top-level structure:

| Field | Required | Type | Description |
|-------|----------|------|-------------|
| `omtsf_version` | Yes | string | Semantic version of the OMTSF specification (e.g., `"0.0.1"`) |
| `snapshot_date` | Yes | string (ISO 8601 date) | Date this graph snapshot was produced |
| `file_salt` | Yes | string | 64-character lowercase hexadecimal string (32 bytes). Generated by a CSPRNG. Used for boundary reference hashing (OMTSF-SPEC-004). |
| `disclosure_scope` | No | enum | Intended audience: `internal`, `partner`, or `public`. See OMTSF-SPEC-004 for enforcement rules. |
| `previous_snapshot_ref` | No | string | SHA-256 hash (hex-encoded) or URI of the prior snapshot this file supersedes. Enables temporal audit trails. |
| `snapshot_sequence` | No | integer | Monotonically increasing sequence number. Each successive snapshot from the same producer MUST use a higher value. Enables ordering when timestamps are insufficient. |
| `reporting_entity` | No | string | Graph-local `id` of the `organization` node whose perspective this file represents. Anchors perspective-dependent properties such as `tier`. |
| `nodes` | Yes | array | Array of node objects |
| `edges` | Yes | array | Array of edge objects |

### 2.1 Serialization Conventions

**Edge property wrapper.** Edge properties listed in Sections 5, 6, and 7 are **logical properties** of each edge type. In JSON serialization, these properties MUST be nested inside a `"properties"` object on the edge. The structural fields `id`, `type`, `source`, and `target` are top-level fields on the edge object; all other fields are inside `properties`. Example:

```json
{
  "id": "edge-001",
  "type": "supplies",
  "source": "org-bolt",
  "target": "org-acme",
  "properties": {
    "valid_from": "2023-01-15",
    "commodity": "7318.15"
  }
}
```

**First key requirement.** The first key in the top-level JSON object MUST be `"omtsf_version"`. Consumers MUST NOT reject files where `omtsf_version` is present but not the first key.

**Date format.** All date fields in an `.omts` file MUST use the ISO 8601 calendar date format `YYYY-MM-DD` (e.g., `2026-02-18`). No other ISO 8601 profiles (week dates, ordinal dates) are permitted.

### 2.2 Version Compatibility Rules

The `omtsf_version` field uses semantic versioning (`MAJOR.MINOR.PATCH`). The following rules define consumer behavior when encountering version mismatches:

**Minor version increment** (e.g., `0.1.0` → `0.2.0`) indicates backward-compatible additions: new optional fields, new node or edge types, new extension schemes, or new L2/L3 validation rules. Consumers encountering a file with a higher minor version than they support SHOULD process all known fields and MUST preserve unknown fields during round-trip serialization. Unknown fields MUST NOT cause validation failure.

**Major version increment** (e.g., `0.x` → `1.0.0`) indicates potentially breaking changes: removal of required fields, changes to identity predicate semantics, changes to merge algebra, or redefinition of existing node/edge type semantics. Consumers encountering a file with a higher major version than they support SHOULD reject the file or emit a prominent warning that processing may produce incorrect results.

**Patch version increment** (e.g., `0.1.0` → `0.1.1`) indicates editorial corrections, clarifications, or errata that do not change the file format. Consumers MUST treat files with different patch versions as equivalent.

**Pre-1.0 convention.** While `omtsf_version` has a major version of `0`, the format is considered unstable. Minor version increments MAY include breaking changes. Consumers SHOULD treat any version mismatch in the `0.x` series as potentially incompatible.

---

## 3. Graph-Local Identity

### 3.1 Node Identity

Every node in an `.omts` file MUST have an `id` field containing a string that is unique within that file. This ID is used solely for edge source/target references within the same file. It carries no semantic meaning and MUST NOT be used for cross-file merge or entity resolution.

Producers MAY use any string format for graph-local IDs: UUIDs, sequential integers, human-readable slugs, or opaque tokens. Validators MUST only enforce uniqueness within the file.

### 3.2 Edge Identity

Every edge in an `.omts` file MUST have an `id` field containing a string that is unique within that file. This supports the directed labeled multigraph model: multiple edges of the same type between the same pair of nodes are permitted and distinguished by their independent IDs.

Edges MAY carry an optional `identifiers` array with the same structure as node identifiers (defined in OMTSF-SPEC-002), enabling cross-file merge of edges when needed.

---

## 4. Node Types

OMTSF defines six core node types and one structural type.

### 4.1 `organization`

A legal entity: a company, non-governmental organization, government body, or other formally registered entity with legal standing.

**Properties:**
- `name` (required): Legal name of the entity
- `jurisdiction` (recommended): ISO 3166-1 alpha-2 country code of incorporation or primary registration
- `status` (optional): `active`, `dissolved`, `merged`, `suspended`
- `governance_structure` (optional): `sole_subsidiary`, `joint_venture`, `consortium`, `cooperative`. Indicates shared governance.

### 4.2 `facility`

A physical location: a factory, warehouse, farm, mine, port, or office.

**Properties:**
- `name` (required): Name or label of the facility
- `operator` (recommended): Graph-local `id` of the `organization` node that operates this facility (also representable as an edge)
- `address` (optional): Structured or free-text address
- `geo` (optional): WGS 84 coordinates (`lat`, `lon`) or GeoJSON geometry for polygon boundaries

### 4.3 `good`

A product, material, commodity, or service that flows through the supply network.

**Properties:**
- `name` (required): Name or description of the good
- `commodity_code` (optional): HS or CN code
- `unit` (optional): Unit of measure (e.g., `kg`, `mt`, `pcs`)

### 4.4 `person`

A natural person relevant to the supply chain graph, typically as a beneficial owner, director, or authorized representative.

**Properties:**
- `name` (required): Full name of the person
- `jurisdiction` (recommended): ISO 3166-1 alpha-2 country code of nationality or primary residence
- `role` (optional): Free-text description of the person's role (e.g., "Ultimate Beneficial Owner", "Director")

**Privacy constraints** for `person` nodes are defined in OMTSF-SPEC-004.

### 4.5 `attestation`

A document, certificate, audit result, or due diligence statement that is linked to one or more entities or facilities.

**Properties:**

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `name` | Yes | string | Name or title of the attestation |
| `attestation_type` | Yes | enum | One of: `certification`, `audit`, `due_diligence_statement`, `self_declaration`, `other` |
| `standard` | No | string | The standard or framework (e.g., `SA8000`, `ISO 14001`, `SMETA`, `EUDR-DDS`) |
| `issuer` | No | string | Name of the issuing/certifying body |
| `valid_from` | Yes | ISO 8601 date | Date the attestation became effective |
| `valid_to` | No | ISO 8601 date | Expiration date. `null` = no expiration. |
| `outcome` | No | enum | `pass`, `conditional_pass`, `fail`, `pending`, `not_applicable` |
| `status` | No | enum | Lifecycle state: `active`, `suspended`, `revoked`, `expired`, `withdrawn`. Distinct from `valid_to` (an `active` attestation may have a future `valid_to`; a `revoked` attestation may still be within its validity period). Default: `active`. |
| `reference` | No | string | Document reference number or URI |
| `risk_severity` | No | enum | Risk severity classification: `critical`, `high`, `medium`, `low`. |
| `risk_likelihood` | No | enum | Likelihood of the identified risk: `very_likely`, `likely`, `possible`, `unlikely`. |

Attestation nodes MAY carry an `identifiers` array (e.g., an EUDR due diligence statement number, an internal audit ID).

**Usage example:**

```json
{
  "id": "att-sa8000-bolt",
  "type": "attestation",
  "name": "SA8000 Certification - Bolt Sheffield Plant",
  "attestation_type": "certification",
  "standard": "SA8000:2014",
  "issuer": "Social Accountability International",
  "valid_from": "2025-06-01",
  "valid_to": "2028-05-31",
  "outcome": "pass"
}
```

### 4.6 `consignment`

A batch, lot, shipment, or consignment of goods.

**Properties:**

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `name` | Yes | string | Description or label of the consignment |
| `lot_id` | No | string | Lot or batch number |
| `quantity` | No | number | Quantity in the specified unit |
| `unit` | No | string | Unit of measure (e.g., `kg`, `mt`, `pcs`) |
| `production_date` | No | ISO 8601 date | Date the consignment was produced or harvested |
| `origin_country` | No | string | ISO 3166-1 alpha-2 country code of origin |
| `direct_emissions_co2e` | No | number | Direct (Scope 1) embedded emissions in tonnes CO2 equivalent. |
| `indirect_emissions_co2e` | No | number | Indirect (Scope 2) embedded emissions in tonnes CO2 equivalent. |
| `emission_factor_source` | No | enum | Source of emissions data: `actual` (installation-level measurement), `default_eu` (EU default values per Annex III), `default_country` (third-country default values). |
| `installation_id` | No | string | Graph-local `id` of the `facility` node representing the producing installation. Also representable as a `produces` edge from the facility to the consignment. |

### 4.7 `boundary_ref`

A minimal node stub that replaces a redacted node in a subgraph projection, preserving graph connectivity without revealing the entity's identity. Defined in OMTSF-SPEC-004.

---

## 5. Corporate Hierarchy Edge Types

These edge types represent corporate structure, aligned with GLEIF Level 2 relationship data.

### 5.1 `ownership`

An equity ownership relationship between two `organization` nodes.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `percentage` | Yes | number (0--100) | Ownership percentage. `0` indicates a known relationship where percentage is unknown. |
| `direct` | No | boolean | `true` if direct ownership, `false` if indirect. Default: `true`. |
| `valid_from` | Yes | ISO 8601 date | Date this ownership relationship became effective |
| `valid_to` | No | ISO 8601 date | Date this relationship ended. `null` = current. |

### 5.2 `operational_control`

Operational control without equity ownership. Covers franchises, management contracts, tolling arrangements, and licensed manufacturing.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `control_type` | Yes | enum | One of: `franchise`, `management`, `tolling`, `licensed_manufacturing`, `other` |
| `valid_from` | Yes | ISO 8601 date | |
| `valid_to` | No | ISO 8601 date | |

### 5.3 `legal_parentage`

Direct legal parent-subsidiary relationship. Maps to GLEIF Level 2 `IS_DIRECTLY_CONSOLIDATED_BY`.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `valid_from` | Yes | ISO 8601 date | |
| `valid_to` | No | ISO 8601 date | |
| `consolidation_basis` | No | enum | `ifrs10`, `us_gaap_asc810`, `other`, `unknown` |

**Direction convention:** Edge points from child (subsidiary) to parent. `source` = subsidiary, `target` = parent.

### 5.4 `former_identity`

Represents identity transformation events: mergers, acquisitions, renames, and demergers.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `event_type` | Yes | enum | One of: `merger`, `acquisition`, `rename`, `demerger`, `spin_off` |
| `effective_date` | Yes | ISO 8601 date | Date the event took effect |
| `description` | No | string | Human-readable description of the event |

**Direction convention:** Edge points from the predecessor entity to the successor entity. `source` = old identity, `target` = new/surviving identity.

### 5.5 `beneficial_ownership`

An ownership or control relationship between a `person` node and an `organization` node.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `percentage` | No | number (0--100) | Ownership percentage. Omit if unknown. |
| `control_type` | Yes | enum | One of: `voting_rights`, `capital`, `other_means`, `senior_management` |
| `direct` | No | boolean | `true` if direct ownership, `false` if through intermediary entities. Default: `true`. |
| `valid_from` | Yes | ISO 8601 date | |
| `valid_to` | No | ISO 8601 date | |

**Direction convention:** `source` = `person` (the beneficial owner), `target` = `organization` (the entity owned/controlled).

**Determining UBO status:** Under AMLD, a person is a UBO if they hold >25% of shares or voting rights, or exercise control through other means. OMTSF records the raw ownership data; the 25% threshold determination is a tooling concern.

**Privacy:** `beneficial_ownership` edges inherit the sensitivity constraints of `person` nodes (see OMTSF-SPEC-004). They default to `sensitivity: "confidential"` and MUST be omitted from files with `disclosure_scope: "public"`.

---

## 6. Supply Relationship Edge Types

These edge types describe commercial and operational supply relationships. Two parties modeling the same supply relationship must use compatible edge types for merge to produce correct results.

### 6.1 `supplies`

A direct commercial supply relationship: one entity sells goods or services to another.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `valid_from` | Yes | ISO 8601 date | Start of the supply relationship |
| `valid_to` | No | ISO 8601 date | End of the supply relationship. `null` = ongoing. |
| `commodity` | No | string | HS code or free-text description of what is supplied |
| `contract_ref` | No | string | Reference to a contract or purchase agreement |
| `volume` | No | number | Volume or quantity supplied per period |
| `volume_unit` | No | string | Unit of measure for volume (e.g., `kg`, `mt`, `pcs`, `units`) |
| `annual_value` | No | number | Annual monetary value of the supply relationship |
| `value_currency` | No | string | ISO 4217 currency code for `annual_value` (e.g., `EUR`, `USD`) |
| `tier` | No | integer | Supply chain tier relative to the reporting entity (1 = direct, 2 = tier 2, etc.) |
| `share_of_buyer_demand` | No | number (0--100) | Percentage of the buyer's total demand for this commodity fulfilled by this supplier. Enables supply concentration and disruption impact modeling. |

**Direction convention:** `source` = supplier, `target` = buyer.

### 6.2 `subcontracts`

A delegated production relationship: one entity contracts another to perform production work on its behalf.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `valid_from` | Yes | ISO 8601 date | |
| `valid_to` | No | ISO 8601 date | |
| `commodity` | No | string | What is subcontracted |
| `contract_ref` | No | string | Subcontracting agreement reference |
| `volume` | No | number | Volume or quantity supplied per period |
| `volume_unit` | No | string | Unit of measure for volume (e.g., `kg`, `mt`, `pcs`, `units`) |
| `share_of_buyer_demand` | No | number (0--100) | Percentage of the contracting entity's demand for this commodity fulfilled by this subcontractor. |

**Direction convention:** `source` = subcontractor, `target` = contracting entity.

### 6.3 `tolls`

A tolling or processing arrangement: one entity provides raw materials to another, which processes them and returns the finished or semi-finished product. The material owner retains ownership throughout.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `valid_from` | Yes | ISO 8601 date | |
| `valid_to` | No | ISO 8601 date | |
| `commodity` | No | string | Material being tolled/processed |

**Direction convention:** `source` = toll processor, `target` = material owner.

**Clarification:** In a tolling arrangement, the `source` (toll processor) receives materials from and returns processed goods to the `target` (material owner). The edge direction represents the service relationship, not material flow.

### 6.4 `distributes`

A logistics or distribution relationship: one entity provides warehousing, transportation, or distribution services for another's goods.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `valid_from` | Yes | ISO 8601 date | |
| `valid_to` | No | ISO 8601 date | |
| `service_type` | No | enum | `warehousing`, `transport`, `fulfillment`, `other` |

**Direction convention:** `source` = logistics provider, `target` = goods owner.

### 6.5 `brokers`

An intermediary relationship: one entity arranges transactions between buyers and sellers without taking possession of the goods.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `valid_from` | Yes | ISO 8601 date | |
| `valid_to` | No | ISO 8601 date | |
| `commodity` | No | string | What is brokered |

**Direction convention:** `source` = broker, `target` = entity on whose behalf the broker acts.

### 6.6 `operates`

An operational relationship between an `organization` node and a `facility` node.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `valid_from` | Yes | ISO 8601 date | |
| `valid_to` | No | ISO 8601 date | |

**Direction convention:** `source` = organization, `target` = facility.

### 6.7 `produces`

A production relationship between a `facility` node and a `good` node, indicating that the facility produces or processes that good.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `valid_from` | Yes | ISO 8601 date | |
| `valid_to` | No | ISO 8601 date | |

**Direction convention:** `source` = facility, `target` = good.

### 6.8 `composed_of`

A bill-of-materials relationship between a `good` node and its component inputs.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `quantity` | No | number | Quantity of the component per unit of the parent good |
| `unit` | No | string | Unit of measure for quantity |
| `valid_from` | No | ISO 8601 date | |
| `valid_to` | No | ISO 8601 date | |

**Direction convention:** `source` = parent/assembled good, `target` = component good or consignment.

**Usage:** A good node "Finished Widget" with `composed_of` edges to "Steel Rod" and "Plastic Housing" represents a two-component BOM.

### 6.9 `sells_to`

A downstream commercial relationship: one entity sells goods or services to a customer. This is the downstream counterpart of `supplies` (which models the upstream perspective).

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `valid_from` | Yes | ISO 8601 date | |
| `valid_to` | No | ISO 8601 date | |
| `commodity` | No | string | HS code or description |
| `contract_ref` | No | string | Contract or sales agreement reference |

**Direction convention:** `source` = seller, `target` = customer.

---

## 7. Attestation Edge Type

### 7.1 `attested_by`

Links an entity, facility, or good to an attestation.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `scope` | No | string | Aspect the attestation covers. Recommended values: `labor_rights`, `environmental`, `deforestation_free`, `carbon_emissions`, `health_safety`, `anti_corruption`, `conflict_minerals`, `other`. Free-text values are permitted for domain-specific scopes. |

**Direction convention:** `source` = the entity/facility/good being attested, `target` = the `attestation` node.

---

## 8. Extension Mechanism

### 8.1 Custom Node Types

Producers MAY define custom node types using reverse-domain notation (e.g., `com.example.custom-node`). Validators encountering an unrecognized node type MUST NOT reject the file.

### 8.2 Custom Edge Types

Producers MAY define custom edge types using reverse-domain notation (e.g., `com.example.custom-edge`). Validators encountering an unrecognized edge type that uses reverse-domain notation MUST NOT reject the file.

### 8.3 Data Quality Metadata

All nodes and edges MAY carry an optional `data_quality` object (serialized at the top level for nodes, inside `properties` for edges) with the following fields:

| Field | Type | Description |
|-------|------|-------------|
| `confidence` | enum | `verified`, `reported`, `inferred`, `estimated`. Default: `reported`. |
| `source` | string | Provenance description (e.g., `gleif-api`, `supplier-questionnaire`, `manual-review`) |
| `last_verified` | ISO 8601 date | Date the data was last verified against an authoritative source |

This metadata is informational. Validators MUST NOT reject files based on `data_quality` values. Merge engines MAY use `confidence` to weight conflict resolution.

### 8.4 Labels

All nodes and edges MAY carry an optional `labels` array for general-purpose classification. Each entry in the array is an object with the following fields:

| Field | Required | Type | Description |
|-------|----------|------|-------------|
| `key` | Yes | string | Classification key. Custom keys SHOULD use reverse-domain notation (e.g., `com.example.risk-tier`). |
| `value` | No | string | Classification value. When omitted, the label acts as a boolean flag (presence = true). |

**Serialization.** On nodes, `labels` is a top-level array. On edges, `labels` is nested inside the `properties` object (following the same pattern as `data_quality` in Section 8.3).

**Key naming conventions:**

- Keys without a dot are reserved for future OMTSF-defined vocabularies.
- Custom keys SHOULD use reverse-domain notation to avoid collisions (e.g., `com.acme.priority`, `org.fairtrade.certified`).
- Keys are case-sensitive. Producers SHOULD use lowercase kebab-case.

**A label without a `value`** is a boolean flag — its presence asserts the classification. A label with a `value` is a key-value classification.

**Labels do NOT participate in identity predicates.** They are not considered during merge candidate detection (OMTSF-SPEC-003, Section 2). During merge, labels are combined by set union of `{key, value}` pairs (OMTSF-SPEC-003, Section 4).

> **Recommended vocabularies.** Appendix B defines recommended label keys for common supply chain, procurement, and regulatory classifications using OMTSF-reserved (dotless) keys. Producers SHOULD prefer these standard keys over custom equivalents to maximize cross-organization interoperability.

**Examples:**

A node with labels:
```json
{
  "id": "org-bolt",
  "type": "organization",
  "name": "Bolt Supplies Ltd",
  "labels": [
    { "key": "com.acme.strategic-supplier" },
    { "key": "com.acme.risk-tier", "value": "high" },
    { "key": "org.fairtrade.certified", "value": "2026" }
  ]
}
```

An edge with labels (inside `properties`):
```json
{
  "id": "edge-001",
  "type": "supplies",
  "source": "org-bolt",
  "target": "org-acme",
  "properties": {
    "valid_from": "2023-01-15",
    "commodity": "7318.15",
    "labels": [
      { "key": "com.acme.critical-path" },
      { "key": "com.acme.sourcing-category", "value": "fasteners" }
    ]
  }
}
```

**Temporal validity.** Labels represent classifications as of the file's `snapshot_date`. Classifications change over time — regulatory risk tiers are reassessed, supplier segmentation quadrants shift with market conditions, and entity list designations are updated on a rolling basis. To determine when a label was current, consumers SHOULD use `snapshot_date` (file-level) and `data_quality.last_verified` (node/edge-level) as temporal signals. Comparing successive snapshots via `previous_snapshot_ref` enables tracking classification changes over time.

**Organizational scope.** When a classification is scoped to a specific buying organization (e.g., SAP purchasing organization, Oracle procurement BU, D365 legal entity), producers SHOULD embed the organizational scope in the label key. For example, two purchasing organizations that classify the same vendor differently:

```json
"labels": [
  { "key": "com.acme.ekorg-1000.vendor-group", "value": "strategic" },
  { "key": "com.acme.ekorg-2000.vendor-group", "value": "standard" }
]
```

This convention allows org-scoped classifications to coexist on the same node after merge without ambiguity.

---

## 9. Validation Rules

### 9.1 Level 1 -- Structural Integrity

These rules MUST pass for a file to be considered structurally valid.

| Rule | Description |
|------|-------------|
| L1-GDM-01 | Every node MUST have an `id` field containing a non-empty string unique within the file |
| L1-GDM-02 | Every edge MUST have an `id` field containing a non-empty string unique within the file |
| L1-GDM-03 | Every edge `source` and `target` MUST reference an existing node `id` in the same file |
| L1-GDM-04 | Edge `type` MUST be one of the recognized edge types defined in this specification — `ownership`, `operational_control`, `legal_parentage`, `former_identity`, `beneficial_ownership` (Section 5); `supplies`, `subcontracts`, `tolls`, `distributes`, `brokers`, `operates`, `produces`, `composed_of`, `sells_to` (Section 6); `attested_by` (Section 7) — or `same_as` (defined in OMTSF-SPEC-003, Section 7), or an extension type using reverse-domain notation |
| L1-GDM-05 | If `reporting_entity` is present in the file header, it MUST reference an existing node `id` with `type: "organization"` |

### 9.2 Level 2 -- Completeness

These rules SHOULD be satisfied. Violations produce warnings, not errors.

| Rule | Description |
|------|-------------|
| L2-GDM-01 | Every `facility` node SHOULD be connected to an `organization` node via an edge or the `operator` property |
| L2-GDM-02 | `ownership` edges SHOULD have `valid_from` set |
| L2-GDM-03 | Every `organization` and `facility` node, and every `supplies`, `subcontracts`, and `tolls` edge, SHOULD carry a `data_quality` object (Section 8.3). Provenance metadata is essential for merge conflict resolution and regulatory audit trails. |
| L2-GDM-04 | If any `supplies` edge carries a `tier` property, the file SHOULD declare `reporting_entity` in the file header. Without a reporting entity, `tier` values are ambiguous. |

### 9.3 Structural Constraints

**Cycle legality.** Cycles are permitted in the supply relationship subgraph (`supplies`, `subcontracts`, `tolls`, `distributes`, `brokers`, `sells_to`) — circular supply chains exist in practice (e.g., recycling loops). Cycles are NOT permitted in the `legal_parentage` subgraph (L3-MRG-02 in OMTSF-SPEC-003 enforces this as a forest constraint). Cycles in `ownership` are permitted (cross-holdings are common).

### 9.4 Advisory Size Limits

To support parser safety and prevent denial-of-service when processing untrusted input, implementations SHOULD enforce the following limits:

| Limit | Recommended Maximum |
|-------|-------------------|
| Nodes per file | 1,000,000 |
| Edges per file | 5,000,000 |
| Identifiers per node | 50 |
| String field length | 10,000 UTF-8 bytes |
| `file_salt` length | Exactly 64 hex characters (MUST match `^[0-9a-f]{64}$`) |
| Labels per node/edge | 100 |

These are advisory limits, not hard constraints. Producers MAY exceed them.

### 9.5 Graph Type Constraints

The following table defines the permitted source and target node types for each edge type. Edges that violate these constraints MUST be rejected at L1 validation.

| Edge Type | Permitted Source Types | Permitted Target Types |
|-----------|----------------------|----------------------|
| `ownership` | `organization` | `organization` |
| `operational_control` | `organization` | `organization`, `facility` |
| `legal_parentage` | `organization` | `organization` |
| `former_identity` | `organization` | `organization` |
| `beneficial_ownership` | `person` | `organization` |
| `supplies` | `organization` | `organization` |
| `subcontracts` | `organization` | `organization` |
| `tolls` | `organization`, `facility` | `organization` |
| `distributes` | `organization` | `organization` |
| `brokers` | `organization` | `organization` |
| `operates` | `organization` | `facility` |
| `produces` | `facility` | `good`, `consignment` |
| `composed_of` | `good`, `consignment` | `good`, `consignment` |
| `sells_to` | `organization` | `organization` |
| `attested_by` | `organization`, `facility`, `good`, `consignment` | `attestation` |
| `same_as` | *any* | *any* (same type as source recommended) |

Extension edge types (reverse-domain notation) are not constrained by this table. Validators MUST NOT enforce source/target type constraints on extension edges.

---

## 10. Serialization Example

A complete minimal `.omts` file demonstrating the graph data model:

```json
{
  "omtsf_version": "0.0.1",
  "snapshot_date": "2026-02-17",
  "file_salt": "a1b2c3d4e5f67890a1b2c3d4e5f67890a1b2c3d4e5f67890a1b2c3d4e5f67890",
  "disclosure_scope": "partner",
  "reporting_entity": "org-acme",
  "nodes": [
    {
      "id": "org-acme",
      "type": "organization",
      "name": "Acme Manufacturing GmbH",
      "jurisdiction": "DE",
      "identifiers": [
        { "scheme": "lei", "value": "5493006MHB84DD0ZWV18" },
        { "scheme": "nat-reg", "value": "HRB86891", "authority": "RA000548" },
        { "scheme": "vat", "value": "DE123456789", "authority": "DE", "sensitivity": "restricted" },
        { "scheme": "duns", "value": "081466849" },
        { "scheme": "internal", "value": "V-100234", "authority": "sap-mm-prod", "sensitivity": "restricted" }
      ]
    },
    {
      "id": "org-bolt",
      "type": "organization",
      "name": "Bolt Supplies Ltd",
      "jurisdiction": "GB",
      "identifiers": [
        { "scheme": "nat-reg", "value": "07228507", "authority": "RA000585" },
        { "scheme": "duns", "value": "234567890" }
      ],
      "labels": [
        { "key": "com.acme.strategic-supplier" },
        { "key": "com.acme.risk-tier", "value": "low" }
      ]
    },
    {
      "id": "fac-bolt-sheffield",
      "type": "facility",
      "name": "Bolt Sheffield Plant",
      "identifiers": [
        { "scheme": "gln", "value": "5060012340001" },
        { "scheme": "internal", "value": "SITE-SHF-01", "authority": "bolt-erp" }
      ],
      "geo": { "lat": 53.3811, "lon": -1.4701 }
    },
    {
      "id": "good-steel-bolts",
      "type": "good",
      "name": "M10 Steel Hex Bolts",
      "identifiers": [
        { "scheme": "org.gs1.gtin", "value": "05060012340018" }
      ],
      "commodity_code": "7318.15"
    },
    {
      "id": "att-sa8000",
      "type": "attestation",
      "name": "SA8000 Certification",
      "attestation_type": "certification",
      "standard": "SA8000:2014",
      "issuer": "Social Accountability International",
      "valid_from": "2025-06-01",
      "valid_to": "2028-05-31",
      "outcome": "pass"
    }
  ],
  "edges": [
    {
      "id": "edge-001",
      "type": "supplies",
      "source": "org-bolt",
      "target": "org-acme",
      "properties": {
        "valid_from": "2023-01-15",
        "valid_to": null,
        "commodity": "7318.15",
        "tier": 1,
        "labels": [
          { "key": "com.acme.critical-path" }
        ]
      }
    },
    {
      "id": "edge-002",
      "type": "operates",
      "source": "org-bolt",
      "target": "fac-bolt-sheffield",
      "properties": {
        "valid_from": "2018-06-01"
      }
    },
    {
      "id": "edge-003",
      "type": "produces",
      "source": "fac-bolt-sheffield",
      "target": "good-steel-bolts",
      "properties": {
        "valid_from": "2020-03-01"
      }
    },
    {
      "id": "edge-004",
      "type": "ownership",
      "source": "org-acme",
      "target": "org-bolt",
      "properties": {
        "percentage": 51.0,
        "valid_from": "2019-04-01"
      }
    },
    {
      "id": "edge-005",
      "type": "attested_by",
      "source": "fac-bolt-sheffield",
      "target": "att-sa8000",
      "properties": {
        "scope": "working conditions"
      }
    }
  ]
}
```

---

## 11. Conformance Clauses

This section defines the conformance requirements for the three roles that interact with `.omts` files.

### 11.1 Conformant Producer

A **conformant producer** is a system that generates `.omts` files. A conformant producer MUST:

1. Produce files that pass all L1 validation rules defined in this specification (Section 9.1), OMTSF-SPEC-002 (Section 6.1), and OMTSF-SPEC-004 (Section 6.1).
2. Set `omtsf_version` to a version of this specification that the producer implements.
3. Generate `file_salt` using a CSPRNG (Section 2).
4. Use the `"properties"` wrapper for all edge properties (Section 2.1).
5. Ensure all graph-local node and edge IDs are unique within the file.
6. Enforce graph type constraints (Section 9.5) for all core edge types.
7. Respect `disclosure_scope` sensitivity constraints (OMTSF-SPEC-004, Section 3) when declared.

A conformant producer SHOULD satisfy L2 validation rules and SHOULD include `data_quality` metadata on nodes and edges.

### 11.2 Conformant Consumer

A **conformant consumer** is a system that reads and processes `.omts` files. A conformant consumer MUST:

1. Accept any file that passes L1 validation without error.
2. Preserve unknown fields during round-trip serialization (forward compatibility).
3. Not reject files containing extension node types, extension edge types, or unknown identifier schemes.
4. Follow version compatibility rules (Section 2.2) when encountering version mismatches.

A conformant consumer SHOULD process L2 validation warnings and present them to the user.

### 11.3 Conformant Validator

A **conformant validator** is a system that checks `.omts` files against the validation rules defined in this specification and related specifications. A conformant validator MUST:

1. Implement all L1 validation rules from this specification (Section 9.1), OMTSF-SPEC-002 (Section 6.1), and OMTSF-SPEC-004 (Section 6.1).
2. Report L1 violations as errors.
3. Clearly distinguish between L1 errors, L2 warnings, and L3 informational findings in output.
4. Not reject files based on unknown fields, extension types, or `data_quality` values.
5. Report the specific rule identifier (e.g., `L1-GDM-01`) for each finding.

A conformant validator SHOULD implement L2 rules and MAY implement L3 rules.

---

## Appendix A: N-ary Relationship Reification Pattern (Informative)

To model an n-ary relationship (three or more parties bound by a single arrangement), create an intermediate node representing the arrangement and connect each participant via binary edges. This preserves the binary edge model while capturing multi-party structures.

**Example: Three-Party Tolling Arrangement**

```json
{
  "nodes": [
    { "id": "org-company-a", "type": "organization", "name": "Company A" },
    { "id": "org-processor-b", "type": "organization", "name": "Processor B" },
    { "id": "org-finisher-c", "type": "organization", "name": "Finisher C" },
    {
      "id": "arr-tolling-001",
      "type": "com.omtsf.arrangement",
      "name": "Tripartite Tolling Agreement #TA-2026-001"
    }
  ],
  "edges": [
    {
      "id": "e1", "type": "com.omtsf.participates_in",
      "source": "org-company-a", "target": "arr-tolling-001",
      "properties": { "role": "material_owner" }
    },
    {
      "id": "e2", "type": "com.omtsf.participates_in",
      "source": "org-processor-b", "target": "arr-tolling-001",
      "properties": { "role": "primary_processor" }
    },
    {
      "id": "e3", "type": "com.omtsf.participates_in",
      "source": "org-finisher-c", "target": "arr-tolling-001",
      "properties": { "role": "secondary_processor" }
    },
    {
      "id": "e4", "type": "tolls",
      "source": "org-processor-b", "target": "org-company-a",
      "properties": { "valid_from": "2026-01-01", "commodity": "7208.10" }
    },
    {
      "id": "e5", "type": "tolls",
      "source": "org-finisher-c", "target": "org-company-a",
      "properties": { "valid_from": "2026-01-01", "commodity": "7209.15" }
    }
  ]
}
```

For simple binary relationships, standard edge types are sufficient and preferred.

---

## Appendix B: Recommended Label Keys (Informative)

This appendix defines recommended label keys for common supply chain, procurement, and regulatory classifications. These keys use OMTSF-reserved (dotless) names. Producers SHOULD prefer these keys over custom equivalents when the semantics match. Producers SHOULD use lowercase kebab-case for both keys and values.

### B.1 Procurement Classification

| Key | Values | Description |
|-----|--------|-------------|
| `kraljic-quadrant` | `strategic`, `leverage`, `bottleneck`, `non-critical` | Kraljic portfolio classification based on supply risk and profit impact. |
| `approval-status` | `approved`, `conditional`, `pending`, `blocked`, `phase-out` | Supplier approval lifecycle state. |
| `sourcing-strategy` | `sole-source`, `single-source`, `dual-source`, `multi-source` | Sourcing strategy for the supplier or supply relationship. |

### B.2 Supplier Diversity

| Key | Values | Description |
|-----|--------|-------------|
| `diversity-classification` | `minority-owned`, `woman-owned`, `veteran-owned`, `disability-owned`, `lgbtbe`, `small-business`, `hubzone` | Supplier diversity certification category. Multiple labels with different values are permitted for suppliers with multiple certifications. |

### B.3 Regulatory Scope

| Key | Values | Description |
|-----|--------|-------------|
| `lksg-risk-priority` | `high`, `medium`, `low` | Risk priority tier under the German Supply Chain Due Diligence Act (LkSG). |
| `lksg-in-scope` | *(boolean flag, no value)* | Entity is within scope of LkSG due diligence obligations. |
| `csddd-in-scope` | *(boolean flag, no value)* | Entity is within scope of EU Corporate Sustainability Due Diligence Directive (CSDDD) obligations. |
| `eudr-commodity-scope` | `cattle`, `cocoa`, `coffee`, `oil-palm`, `rubber`, `soya`, `wood` | EUDR commodity classification for the entity or supply relationship. Multiple values permitted. |
| `eudr-country-risk` | `low`, `standard`, `high` | EUDR country risk classification per European Commission benchmarking. |
| `uflpa-entity-list` | *(boolean flag, no value)* | Entity appears on the UFLPA Entity List maintained by DHS. |
| `cbam-in-scope` | *(boolean flag, no value)* | Entity or facility is subject to EU Carbon Border Adjustment Mechanism reporting. |

### B.4 Risk and Compliance

| Key | Values | Description |
|-----|--------|-------------|
| `risk-tier` | `critical`, `high`, `medium`, `low` | General risk classification. Use regulatory-specific keys (e.g., `lksg-risk-priority`) when the classification is tied to a specific framework. |
| `sanctions-screened` | *(boolean flag, no value)* | Entity has been screened against applicable sanctions lists. |
| `conflict-minerals-smelter` | *(boolean flag, no value)* | Facility is identified as a smelter or refiner under Conflict Minerals Regulation (EU) 2017/821 or SEC Rule 13p-1. |

### B.5 Commodity Classification

| Key | Values | Description |
|-----|--------|-------------|
| `unspsc` | UNSPSC code (e.g., `31162800`) | United Nations Standard Products and Services Code for the commodity supplied. |
| `commodity-group` | Free text | Human-readable commodity grouping for the entity or supply relationship. |

### B.6 Multi-Valued Key Semantics

The `{key, value}` pair is the atomic identity unit for labels. A single node or edge MAY carry multiple labels with the same key but different values — for example, a supplier with both `{key: "eudr-commodity-scope", value: "coffee"}` and `{key: "eudr-commodity-scope", value: "cocoa"}`. After merge, consumers encountering multiple values for the same key SHOULD treat them as observations from different sources rather than a conflict.
