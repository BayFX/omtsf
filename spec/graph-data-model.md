# OMTSF Specification: Graph Data Model

**Spec:** OMTSF-SPEC-001
**Status:** Draft
**Date:** 2026-02-18
**Revision:** 1
**License:** [MIT](../LICENSE)
**Addresses:** R1-C5, R1-C6, R1-C7, R1-P0-4, R1-P0-5, R1-P0-6; R2-C1 (partial, with OMTSF-SPEC-003)

---

## Related Specifications

| Spec | Relationship |
|------|-------------|
| OMTSF-SPEC-002 (Entity Identification) | Defines external identifier structures carried by nodes and edges defined here |
| OMTSF-SPEC-003 (Merge Semantics) | Defines how graphs conforming to this model are combined |
| OMTSF-SPEC-004 (Selective Disclosure) | Defines privacy controls for the `boundary_ref` node type and `person` node constraints |

---

## 1. Overview

This specification defines the OMTSF supply chain graph data model: the file structure, node types, edge types, and structural validation rules that constitute a valid `.omts` file. It is the foundational specification upon which all other OMTSF specs depend.

An `.omts` file represents a directed labeled property multigraph where nodes represent supply chain entities (organizations, facilities, goods, persons, attestations) and edges represent relationships between them (supply, ownership, control, attestation).

---

## 2. File Structure

An `.omts` file is a JSON document with the following top-level structure:

| Field | Required | Type | Description |
|-------|----------|------|-------------|
| `omtsf_version` | Yes | string | Semantic version of the OMTSF specification (e.g., `"0.1.0"`) |
| `snapshot_date` | Yes | string (ISO 8601 date) | Date this graph snapshot was produced |
| `file_salt` | Yes | string | 64-character lowercase hexadecimal string (32 bytes). Generated by a CSPRNG. Used for boundary reference hashing (OMTSF-SPEC-004). |
| `disclosure_scope` | No | enum | Intended audience: `internal`, `partner`, or `public`. See OMTSF-SPEC-004 for enforcement rules. |
| `nodes` | Yes | array | Array of node objects |
| `edges` | Yes | array | Array of edge objects |

---

## 3. Graph-Local Identity

### 3.1 Node Identity

Every node in an `.omts` file MUST have an `id` field containing a string that is unique within that file. This ID is used solely for edge source/target references within the same file. It carries no semantic meaning and MUST NOT be used for cross-file merge or entity resolution.

Producers MAY use any string format for graph-local IDs: UUIDs, sequential integers, human-readable slugs, or opaque tokens. Validators MUST only enforce uniqueness within the file.

### 3.2 Edge Identity

Every edge in an `.omts` file MUST have an `id` field containing a string that is unique within that file. This supports the directed labeled multigraph model: multiple edges of the same type between the same pair of nodes are permitted and distinguished by their independent IDs.

Edges MAY carry an optional `identifiers` array with the same structure as node identifiers (defined in OMTSF-SPEC-002), enabling cross-file merge of edges when needed.

---

## 4. Node Types

OMTSF defines five core node types and one structural type.

### 4.1 `organization`

A legal entity: a company, non-governmental organization, government body, or other formally registered entity with legal standing.

**Properties:**
- `name` (required): Legal name of the entity
- `jurisdiction` (recommended): ISO 3166-1 alpha-2 country code of incorporation or primary registration
- `status` (optional): `active`, `dissolved`, `merged`, `suspended`

### 4.2 `facility`

A physical location: a factory, warehouse, farm, mine, port, or office.

**Properties:**
- `name` (required): Name or label of the facility
- `operator` (recommended): Graph-local `id` of the `organization` node that operates this facility (also representable as an edge)
- `address` (optional): Structured or free-text address
- `geo` (optional): WGS 84 coordinates (`lat`, `lon`) or GeoJSON geometry for polygon boundaries (relevant for EUDR land parcel traceability)

### 4.3 `good`

A product, material, commodity, or service that flows through the supply network.

**Properties:**
- `name` (required): Name or description of the good
- `commodity_code` (optional): HS or CN code
- `unit` (optional): Unit of measure (e.g., `kg`, `mt`, `pcs`)

### 4.4 `person`

A natural person relevant to the supply chain graph, typically as a beneficial owner, director, or authorized representative. This node type addresses CSDDD and EU Anti-Money Laundering Directive (AMLD 5/6) requirements for tracing ownership to natural persons.

**Properties:**
- `name` (required): Full name of the person
- `jurisdiction` (recommended): ISO 3166-1 alpha-2 country code of nationality or primary residence
- `role` (optional): Free-text description of the person's role (e.g., "Ultimate Beneficial Owner", "Director")

**Privacy constraints** for `person` nodes are defined in OMTSF-SPEC-004.

### 4.5 `attestation`

A document, certificate, audit result, or due diligence statement that is linked to one or more entities or facilities.

**Properties:**

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `name` | Yes | string | Name or title of the attestation |
| `attestation_type` | Yes | enum | One of: `certification`, `audit`, `due_diligence_statement`, `self_declaration`, `other` |
| `standard` | No | string | The standard or framework (e.g., `SA8000`, `ISO 14001`, `SMETA`, `EUDR-DDS`) |
| `issuer` | No | string | Name of the issuing/certifying body |
| `valid_from` | Yes | ISO 8601 date | Date the attestation became effective |
| `valid_to` | No | ISO 8601 date | Expiration date. `null` = no expiration. |
| `outcome` | No | enum | `pass`, `conditional_pass`, `fail`, `pending`, `not_applicable` |
| `reference` | No | string | Document reference number or URI |

Attestation nodes MAY carry an `identifiers` array (e.g., an EUDR due diligence statement number, an internal audit ID).

**Usage examples:**

A facility with SA8000 certification:
```json
{
  "id": "att-sa8000-bolt",
  "type": "attestation",
  "name": "SA8000 Certification - Bolt Sheffield Plant",
  "attestation_type": "certification",
  "standard": "SA8000:2014",
  "issuer": "Social Accountability International",
  "valid_from": "2025-06-01",
  "valid_to": "2028-05-31",
  "outcome": "pass"
}
```

An EUDR due diligence statement:
```json
{
  "id": "att-eudr-dds-001",
  "type": "attestation",
  "name": "EUDR Due Diligence Statement #DDS-2026-00142",
  "attestation_type": "due_diligence_statement",
  "standard": "EUDR-DDS",
  "valid_from": "2026-01-15",
  "outcome": "pass",
  "reference": "DDS-2026-00142"
}
```

### 4.6 `boundary_ref`

A minimal node stub that replaces a redacted node in a subgraph projection, preserving graph connectivity without revealing the entity's identity. Defined in OMTSF-SPEC-004.

---

## 5. Corporate Hierarchy Edge Types

These edge types represent corporate structure. They address critical finding C15 (corporate hierarchy absent from data model) and align with GLEIF Level 2 relationship data.

### 5.1 `ownership`

An equity ownership relationship between two `organization` nodes.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `percentage` | Yes | number (0--100) | Ownership percentage. `0` indicates a known relationship where percentage is unknown. |
| `direct` | No | boolean | `true` if direct ownership, `false` if indirect. Default: `true`. |
| `valid_from` | Yes | ISO 8601 date | Date this ownership relationship became effective |
| `valid_to` | No | ISO 8601 date | Date this relationship ended. `null` = current. |

### 5.2 `operational_control`

Operational control without equity ownership. Covers franchises, management contracts, tolling arrangements, and licensed manufacturing.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `control_type` | Yes | enum | One of: `franchise`, `management`, `tolling`, `licensed_manufacturing`, `other` |
| `valid_from` | Yes | ISO 8601 date | |
| `valid_to` | No | ISO 8601 date | |

### 5.3 `legal_parentage`

Direct legal parent-subsidiary relationship. Maps to GLEIF Level 2 `IS_DIRECTLY_CONSOLIDATED_BY`.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `valid_from` | Yes | ISO 8601 date | |
| `valid_to` | No | ISO 8601 date | |
| `consolidation_basis` | No | enum | `ifrs10`, `us_gaap_asc810`, `other`, `unknown` |

**Direction convention:** Edge points from child (subsidiary) to parent. `source` = subsidiary, `target` = parent.

### 5.4 `former_identity`

Represents identity transformation events: mergers, acquisitions, renames, and demergers.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `event_type` | Yes | enum | One of: `merger`, `acquisition`, `rename`, `demerger`, `spin_off` |
| `effective_date` | Yes | ISO 8601 date | Date the event took effect |
| `description` | No | string | Human-readable description of the event |

**Direction convention:** Edge points from the predecessor entity to the successor entity. `source` = old identity, `target` = new/surviving identity.

### 5.5 `beneficial_ownership`

An ownership or control relationship between a `person` node and an `organization` node. Supports the EU CSDDD and AMLD 5/6 requirements for identifying ultimate beneficial owners (UBOs).

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `percentage` | No | number (0--100) | Ownership percentage. Omit if unknown. |
| `control_type` | Yes | enum | One of: `voting_rights`, `capital`, `other_means`, `senior_management` |
| `direct` | No | boolean | `true` if direct ownership, `false` if through intermediary entities. Default: `true`. |
| `valid_from` | Yes | ISO 8601 date | |
| `valid_to` | No | ISO 8601 date | |

**Direction convention:** `source` = `person` (the beneficial owner), `target` = `organization` (the entity owned/controlled).

**Determining UBO status:** Under AMLD, a person is a UBO if they hold >25% of shares or voting rights, or exercise control through other means. OMTSF records the raw ownership data; the 25% threshold determination is a tooling concern.

**Privacy:** `beneficial_ownership` edges inherit the sensitivity constraints of `person` nodes (see OMTSF-SPEC-004). They default to `sensitivity: "confidential"` and MUST be omitted from files with `disclosure_scope: "public"`.

---

## 6. Supply Relationship Edge Types

These edge types describe commercial and operational supply relationships. Two parties modeling the same supply relationship must use compatible edge types for merge to produce correct results.

### 6.1 `supplies`

A direct commercial supply relationship: one entity sells goods or services to another.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `valid_from` | Yes | ISO 8601 date | Start of the supply relationship |
| `valid_to` | No | ISO 8601 date | End of the supply relationship. `null` = ongoing. |
| `commodity` | No | string | HS code or free-text description of what is supplied |
| `contract_ref` | No | string | Reference to a contract or purchase agreement |

**Direction convention:** `source` = supplier, `target` = buyer.

**Regulatory relevance:** A `supplies` edge between two `organization` nodes constitutes a "direct business relationship" under CSDDD Article 3(e) and a "direct supplier" under LkSG Section 2(7).

### 6.2 `subcontracts`

A delegated production relationship: one entity contracts another to perform production work on its behalf.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `valid_from` | Yes | ISO 8601 date | |
| `valid_to` | No | ISO 8601 date | |
| `commodity` | No | string | What is subcontracted |
| `contract_ref` | No | string | Subcontracting agreement reference |

**Direction convention:** `source` = subcontractor, `target` = contracting entity.

**Regulatory relevance:** Subcontracting relationships create indirect supply chain exposure. Under LkSG Section 9, substantiated knowledge of human rights violations at a subcontractor triggers due diligence obligations.

### 6.3 `tolls`

A tolling or processing arrangement: one entity provides raw materials to another, which processes them and returns the finished or semi-finished product. The material owner retains ownership throughout.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `valid_from` | Yes | ISO 8601 date | |
| `valid_to` | No | ISO 8601 date | |
| `commodity` | No | string | Material being tolled/processed |

**Direction convention:** `source` = toll processor, `target` = material owner.

### 6.4 `distributes`

A logistics or distribution relationship: one entity provides warehousing, transportation, or distribution services for another's goods.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `valid_from` | Yes | ISO 8601 date | |
| `valid_to` | No | ISO 8601 date | |
| `service_type` | No | enum | `warehousing`, `transport`, `fulfillment`, `other` |

**Direction convention:** `source` = logistics provider, `target` = goods owner.

### 6.5 `brokers`

An intermediary relationship: one entity arranges transactions between buyers and sellers without taking possession of the goods.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `valid_from` | Yes | ISO 8601 date | |
| `valid_to` | No | ISO 8601 date | |
| `commodity` | No | string | What is brokered |

**Direction convention:** `source` = broker, `target` = entity on whose behalf the broker acts.

### 6.6 `operates`

An operational relationship between an `organization` node and a `facility` node.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `valid_from` | Yes | ISO 8601 date | |
| `valid_to` | No | ISO 8601 date | |

**Direction convention:** `source` = organization, `target` = facility.

### 6.7 `produces`

A production relationship between a `facility` node and a `good` node, indicating that the facility produces or processes that good.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `valid_from` | Yes | ISO 8601 date | |
| `valid_to` | No | ISO 8601 date | |

**Direction convention:** `source` = facility, `target` = good.

---

## 7. Attestation Edge Type

### 7.1 `attested_by`

Links an entity, facility, or good to an attestation.

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| `scope` | No | string | What aspect the attestation covers (e.g., "working conditions", "deforestation-free", "carbon emissions") |

**Direction convention:** `source` = the entity/facility/good being attested, `target` = the `attestation` node.

---

## 8. Extension Mechanism

### 8.1 Custom Node Types

Producers MAY define custom node types using reverse-domain notation (e.g., `com.example.custom-node`). Validators encountering an unrecognized node type MUST NOT reject the file.

### 8.2 Custom Edge Types

Producers MAY define custom edge types using reverse-domain notation (e.g., `com.example.custom-edge`). Validators encountering an unrecognized edge type that uses reverse-domain notation MUST NOT reject the file.

---

## 9. Validation Rules

### 9.1 Level 1 -- Structural Integrity

These rules MUST pass for a file to be considered structurally valid.

| Rule | Description |
|------|-------------|
| L1-GDM-01 | Every node MUST have an `id` field containing a non-empty string unique within the file |
| L1-GDM-02 | Every edge MUST have an `id` field containing a non-empty string unique within the file |
| L1-GDM-03 | Every edge `source` and `target` MUST reference an existing node `id` in the same file |
| L1-GDM-04 | Edge `type` MUST be a recognized edge type from this specification (Sections 5, 6, 7), `same_as` (defined in OMTSF-SPEC-003, Section 7), or an extension type using reverse-domain notation |

### 9.2 Level 2 -- Completeness

These rules SHOULD be satisfied. Violations produce warnings, not errors.

| Rule | Description |
|------|-------------|
| L2-GDM-01 | Every `facility` node SHOULD be connected to an `organization` node via an edge or the `operator` property |
| L2-GDM-02 | `ownership` edges SHOULD have `valid_from` set |

---

## 10. Serialization Example

A complete minimal `.omts` file demonstrating the graph data model:

```json
{
  "omtsf_version": "0.1.0",
  "snapshot_date": "2026-02-17",
  "file_salt": "a1b2c3d4e5f67890a1b2c3d4e5f67890a1b2c3d4e5f67890a1b2c3d4e5f67890",
  "disclosure_scope": "partner",
  "nodes": [
    {
      "id": "org-acme",
      "type": "organization",
      "name": "Acme Manufacturing GmbH",
      "jurisdiction": "DE",
      "identifiers": [
        { "scheme": "lei", "value": "5493006MHB84DD0ZWV18" },
        { "scheme": "nat-reg", "value": "HRB86891", "authority": "RA000548" },
        { "scheme": "vat", "value": "DE123456789", "authority": "DE", "sensitivity": "restricted" },
        { "scheme": "duns", "value": "081466849" },
        { "scheme": "internal", "value": "V-100234", "authority": "sap-mm-prod", "sensitivity": "restricted" }
      ]
    },
    {
      "id": "org-bolt",
      "type": "organization",
      "name": "Bolt Supplies Ltd",
      "jurisdiction": "GB",
      "identifiers": [
        { "scheme": "nat-reg", "value": "07228507", "authority": "RA000585" },
        { "scheme": "duns", "value": "234567890" }
      ]
    },
    {
      "id": "fac-bolt-sheffield",
      "type": "facility",
      "name": "Bolt Sheffield Plant",
      "identifiers": [
        { "scheme": "gln", "value": "5060012340001" },
        { "scheme": "internal", "value": "SITE-SHF-01", "authority": "bolt-erp" }
      ],
      "geo": { "lat": 53.3811, "lon": -1.4701 }
    },
    {
      "id": "good-steel-bolts",
      "type": "good",
      "name": "M10 Steel Hex Bolts",
      "identifiers": [
        { "scheme": "org.gs1.gtin", "value": "05060012340018" }
      ],
      "commodity_code": "7318.15"
    },
    {
      "id": "att-sa8000",
      "type": "attestation",
      "name": "SA8000 Certification",
      "attestation_type": "certification",
      "standard": "SA8000:2014",
      "issuer": "Social Accountability International",
      "valid_from": "2025-06-01",
      "valid_to": "2028-05-31",
      "outcome": "pass"
    }
  ],
  "edges": [
    {
      "id": "edge-001",
      "type": "supplies",
      "source": "org-bolt",
      "target": "org-acme",
      "properties": {
        "valid_from": "2023-01-15",
        "valid_to": null,
        "commodity": "7318.15"
      }
    },
    {
      "id": "edge-002",
      "type": "operates",
      "source": "org-bolt",
      "target": "fac-bolt-sheffield",
      "properties": {
        "valid_from": "2018-06-01"
      }
    },
    {
      "id": "edge-003",
      "type": "produces",
      "source": "fac-bolt-sheffield",
      "target": "good-steel-bolts",
      "properties": {
        "valid_from": "2020-03-01"
      }
    },
    {
      "id": "edge-004",
      "type": "ownership",
      "source": "org-acme",
      "target": "org-bolt",
      "properties": {
        "percentage": 51.0,
        "valid_from": "2019-04-01"
      }
    },
    {
      "id": "edge-005",
      "type": "attested_by",
      "source": "fac-bolt-sheffield",
      "target": "att-sa8000",
      "properties": {
        "scope": "working conditions"
      }
    }
  ]
}
```

This example demonstrates:
- File header with version, snapshot date, salt, and disclosure scope
- All five core node types (organization, facility, good, attestation, and person nodes when present)
- Corporate hierarchy edges (`ownership`)
- Supply relationship edges (`supplies`, `operates`, `produces`)
- Attestation edges (`attested_by`)
- External identifiers on nodes (defined in OMTSF-SPEC-002)
